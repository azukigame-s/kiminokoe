# キミノコエ - テストケース表

## 10月10日 シナリオテストケース

### テストケース一覧

| ケースID | ルート名 | 1枠目 | 2枠目 | 取得エピソード | 秘密基地 | 期待エンド | 備考 |
|---------|---------|-------|-------|---------------|---------|-----------|------|
| TC-001 | 北→東→南 | 北(海) | 東(岩場)→南 | ep_5, ep_3 | × | 中回収 | バス停でイロ迎え |
| TC-002 | 北→東→西 | 北(海) | 東(岩場)→西 | ep_5, ep_2 | × | 中回収 | 海水浴場 |
| TC-003 | 北→東→帰宅 | 北(海) | 東(岩場)→帰宅 | ep_5 | × | 低回収 | 直接帰宅 |
| TC-004 | 北→西 | 北(海) | 西(海水浴場) | ep_2 | × | 低回収 | 最短ルート |
| TC-005 | 東→北 | 東(湧き水) | 北(海) | ep_6, ep_3 | × | 中回収 | バス停でイロ迎え |
| TC-006 | 東→南 | 東(湧き水) | 南(神社) | ep_6, ep_7 | × | 中回収 | 神社 |
| TC-007 | 東→帰宅 | 東(湧き水) | 帰宅 | ep_6 | × | 低回収 | 直接帰宅 |
| TC-008 | 南→北 | 南(お寺) | 北(神社) | ep_7 | ✓ | 低回収 | 秘密基地あり |
| TC-009 | 南→帰宅 | 南(お寺) | 帰宅 | - | ✓ | 最低 | 秘密基地のみ |
| TC-010 | 西→北 | 西(バス停) | 北(海水浴場) | ep_1, ep_2 | × | 中回収 | カード+海 |
| TC-011 | 西→南 | 西(バス停) | 南(焚き場) | ep_1 | ✓ | 低回収 | カード+秘密基地 |
| TC-012 | 西→帰宅 | 西(バス停) | 帰宅 | ep_1 | × | 低回収 | カードのみ |

### トゥルーエンド到達ケース

| ケースID | ルート名 | 1周目 | 2周目 | 取得エピソード | 秘密基地 | 期待エンド | 備考 |
|---------|---------|-------|-------|---------------|---------|-----------|------|
| TC-101 | トゥルー | 南(お寺) | 西(バス停)→北 | ep_1, ep_2, ep_3 | ✓ | トゥルー | 秘密基地+霊体3つ |
| TC-102 | トゥルー | 西(バス停) | 南(お寺)→北 | ep_1, ep_2, ep_3 | ✓ | トゥルー | 秘密基地+霊体3つ |

**注意**: トゥルーエンド条件は「秘密基地 AND (ep_1 AND ep_2 AND ep_3)」のため、1周では到達不可能（2枠では3箇所訪問が必要だが、霊体エピソード3つ+秘密基地=4箇所必要）

### 高回収ケース（5-6エピソード）

| ケースID | ルート名 | 1周目 | 2周目 | 取得エピソード | 秘密基地 | 期待エンド | 備考 |
|---------|---------|-------|-------|---------------|---------|-----------|------|
| TC-201 | 高回収 | 北(海) | 東(岩場)→南→西 | ep_5, ep_3, ep_2 | × | 高回収 | 5エピソード（複数周） |
| TC-202 | 高回収 | 東(湧き水) | 北(海)→南 | ep_6, ep_3, ep_7 | × | 高回収 | 4エピソード |

### エピソード取得マップ

| エピソード | 取得可能ルート | 備考 |
|-----------|--------------|------|
| ep_1 (カード) | 西(バス停) | 秘密基地の空き地 |
| ep_2 (海) | 北→西、西→北 | 海水浴場 |
| ep_3 (バス停) | 北→東→南、東→北 | バス停の小屋 |
| ep_5 (捨て猫) | 北→東 | 岩場の用水路 |
| ep_6 (沢蟹) | 東(湧き水) | 兄の水 |
| ep_7 (神社) | 東→南、南→北 | 神社の擁壁 |

### テスト実行チェックリスト

#### 基本ルート（12ケース）
- [x] TC-001: 北→東→南
> 🔥 指摘事項
> 
> - ✔ ~~シナリオ修正（Gitコミット確認）~~
> - ✔ ~~`📞 [ep_5] 捨て猫 を呼び出し` 後の `僕とスグは、あの子猫を一緒に心配していたんだ。` などのテキストが流れない~~
> - ✔ ~~`📞 [ep_3] バス停 を呼び出し` 後に余分に `……。` が表示される（ `――そうだ……思い出した。` からでよい）~~
> - ✔ ~~`２２：００（分岐部分）` のサブタイトルはゲームに表示不要~~
> - ✔ ~~`[cond_day_1010_ending] ` が表示されない~~
> - ✔ ~~全体的にページ送りの位置がおかしい（特に夕食以降）~~

- [x] TC-002: 北→東→西
> 🔥 指摘事項
> 
> - ✔ ~~`📞 [ep_2] 海 を呼び出し` 後に余分に `……。` が表示される（ `――そうだ……思い出した。` からでよい）~~
> - ✔ ~~全体的にページ送りの位置がおかしい（特に夕食以降）（ページ送りはシナリオの `> ⎘` のみ）~~
> - ✔ ~~`[cond_white_boy_sightings]` で `条件2: 地下道のみ` の場合に分岐のテキストと、分岐後のテキストが表示されない？~~

- [x] TC-003: 北→東→帰宅
- [x] TC-004: 北→西
- [x] TC-005: 東→北
- [x] TC-006: 東→南
- [x] TC-007: 東→帰宅
- [x] TC-008: 南→北
- [x] TC-009: 南→帰宅
- [ ] TC-010: 西→北
- [ ] TC-011: 西→南
- [ ] TC-012: 西→帰宅

#### トゥルーエンド（2ケース）
- [ ] TC-101: 南→西→北（2周プレイ）
- [ ] TC-102: 西→南→北（2周プレイ）

#### 高回収（2ケース）
- [ ] TC-201: 北→東→南→西（複数周プレイ）
- [ ] TC-202: 東→北→南（複数周プレイ）

### 検証項目

各ケースで以下を確認：
1. [ ] 選択肢が正しく表示される
2. [ ] エピソードが正しく取得される
3. [ ] 背景画像が正しく表示される
4. [ ] 19:00夕食シーンに到達する
5. [ ] 21:00共通シーンに到達する
6. [ ] 22:00分岐シーンに到達する
7. [ ] エンディング分岐が正しく判定される
8. [ ] トロフィーが正しく取得される
9. [ ] 秘密基地フラグが正しく設定される（TC-008, TC-009, TC-011, TC-101, TC-102）
10. [ ] 白い服の少年の描写が正しく表示される（ep_1, ep_2, ep_3取得時）

### エンディング分岐確認

| エンディング | 条件 | 確認ケース |
|------------|------|-----------|
| トゥルー条件達成 | 秘密基地 AND (ep_1 AND ep_2 AND ep_3) | TC-101, TC-102 |
| 高回収（トゥルー未達成） | エピソード5-6個 AND NOT トゥルー条件 | TC-201, TC-202 |
| 中回収 | エピソード3-4個 AND NOT トゥルー条件 | TC-001, TC-002, TC-005, TC-006, TC-010 |
| 低回収 | エピソード1-2個 | TC-003, TC-004, TC-007, TC-008, TC-011, TC-012 |
| 最低 | エピソード0個 | TC-009 |

### 注意事項

- 1周プレイではトゥルーエンドに到達できない（2枠では3箇所訪問可能だが、トゥルー条件は4箇所必要）
- 秘密基地は南ルート（お寺）で訪問可能
- 霊体エピソード（ep_1, ep_2, ep_3）は特定のルートでしか取得できない
- 各ルートで取得できるエピソードは固定されているため、トゥルーエンド到達には複数周プレイが必要

### 不具合一覧（全体にかかるもの）

- [x] ~~ルートによって「19:00」のシナリオを2回呼び出してしまうケースがある~~ → day_1010_b_4.json の重複 dinner 呼び出しを削除で修正
- [x] ~~設定画面の設定内容がゲームプレイに反映されない~~ → SceneManager._ready() で起動時に設定を読み込み・適用するように修正
- [x] ~~ゲーム上、ページ送りをしているにも関わらず、インジケーターが⏎になっているものがある~~ → シナリオJSONの go_next フラグを修正
- [x] ~~背景画像の切り替えが行われていないシナリオがある~~ → day_1010_e_2.json を load_scenario に修正
- [x] ~~ゲーム中のポーズ（一息）から設定に遷移しようとすると、すぐに遷移できず「もどる」ボタンで遷移する。また、その経由で遷移した設定画面で「もどる」を押すとゲーム画面（一息画面）にもどらずタイトルに戻ってしまう~~ → settings_return_to による戻り先追跡を実装
- [x] ~~一息画面、足跡画面の「もどる」ボタンが初期表示時にフォーカスされたときのカラーになっている（本来はゲーム開始画面のように少し透過の文字色）~~ → style_back_button で focus_mode = FOCUS_NONE に変更
- [ ] スプラッシュ画面でマウスクリックを行うと進行不能になってしまう